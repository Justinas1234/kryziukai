from typing import Optional
from board import Board
from player import Player
from ai import AI

class Game:
    def __init__(self):
        self.board: Board = Board()
        self.player_marker: Optional[str] = None
        self.ai_marker: Optional[str] = None

    def setup(self) -> None:
        """Sets up the game by choosing markers."""
        self.player_marker = ""
        while self.player_marker not in ["X", "O"]:
            self.player_marker = input("Choose your marker (X or O): ").upper()
        self.ai_marker = "O" if self.player_marker == "X" else "X"

    def play(self) -> None:
        """Starts a new game."""
        self.setup()
        player = Player(self.player_marker)
        ai = AI(self.ai_marker)
        self.board = Board()

        while True:
            self.board.display()

            # Player's turn
            player_move = player.get_move(self.board.available_moves())
            self.board.update(player_move, self.player_marker)
            if self.board.is_winner(self.player_marker):
                self.board.display()
                print("Congratulations, you won!")
                break

            if self.board.is_full():
                self.board.display()
                print("It's a draw!")
                break

            # AI's turn
            print("AI's turn...")
            ai_move = ai.get_move(self.board.board, self.board.available_moves(), self.player_marker)
            self.board.update(ai_move, self.ai_marker)
            if self.board.is_winner(self.ai_marker):
                self.board.display()
                print("AI won! Better luck next time.")
                break

            if self.board.is_full():
                self.board.display()
                print("It's a draw!")
                break
